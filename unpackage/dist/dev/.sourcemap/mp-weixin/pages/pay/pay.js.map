{"version":3,"file":"pay.js","sources":["pages/pay/pay.vue","../../../Program Files/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcGF5L3BheS52dWU"],"sourcesContent":["<template>\r\n\t<view class=\"pay-content\">\r\n\t\t<view class=\"pay-content-top\">\r\n\t\t\t<view class=\"pay-content-detail\">\r\n\t\t\t\t<view class=\"pay-detail-head\">\r\n\t\t\t\t\t<view class=\"pay-head-title\">\r\n\t\t\t\t\t\t{{orderDetail.title}}\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"pay-head-status\">\r\n\t\t\t\t\t\t进行中\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"pay-detail-body\">\r\n\t\t\t\t\t<view class=\"pay-detail-time\">\r\n\t\t\t\t\t\t{{`总周期${getWeeks}期，当前第${now}周`}}\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"pay-detail-rest\">\r\n\t\t\t\t\t\t{{`剩余${orderDetail?.totalNumber - studentsNumber}名额拼满`}}\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"pay-details-msg\">\r\n\t\t\t\t\t<!-- txt -->\r\n\t\t\t\t\t<view class=\"pay-msg-time\">\r\n\t\t\t\t\t\t{{orderDetail?.creatTime}}\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"pay-details-msg\">\r\n\t\t\t\t\t<!-- icon -->\r\n\t\t\t\t\t<uni-icons type=\"location\" size=\"24\"></uni-icons>\r\n\t\t\t\t\t<!-- txt -->\r\n\t\t\t\t\t<view class=\"pay-msg-txt\">\r\n\t\t\t\t\t\t{{orderDetail.adress}}\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view class=\"pay-content-bottom\">\r\n\t\t\t<view class=\"pay-bottom-head\">\r\n\t\t\t\t{{orderDetail.title}}\r\n\t\t\t</view>\r\n\t\t\t<view class=\"pay-bottom-tips\">\r\n\t\t\t\t温馨提示：\r\n\t\t\t</view>\r\n\t\t\t<view class=\"pay-bottom-agree\">\r\n\t\t\t\t<label class=\"pay-agree-radio\">\r\n\t\t\t\t\t<radio :checked=\"ischecked\" @click=\"toggleChecked\" />\r\n\t\t\t\t</label>\r\n\r\n\t\t\t\t<view class=\"pay-agree-txt\">\r\n\t\t\t\t\t同意<span class=\"pay-agree-link\" @click=\"showLink('info')\">《跃动星球协议》</span>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view>\r\n\t\t\t\t\t<!-- 提示窗示例 -->\r\n\t\t\t\t\t<uni-popup ref=\"alertDialog\" type=\"dialog\">\r\n\t\t\t\t\t\t<uni-popup-dialog :type=\"msgType\" cancelText=\"关闭\" confirmText=\"同意\" title=\"跃动星球协议\"\r\n\t\t\t\t\t\t\t:content=\"linkContent\" @confirm=\"dialogConfirm\" @close=\"dialogClose\"></uni-popup-dialog>\r\n\t\t\t\t\t</uni-popup>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"pay-bottom-pay\" @click=\"confirmPay\">\r\n\t\t\t\t确认支付\r\n\t\t\t</view>\r\n\t\t\t<view>\r\n\t\t\t\t<!-- 输入框示例 -->\r\n\t\t\t\t<uni-popup ref=\"inputDialog\" type=\"dialog\">\r\n\t\t\t\t\t<uni-popup-dialog ref=\"inputClose\" mode=\"input\" title=\"输入密码\" placeholder=\"请输入密码\"\r\n\t\t\t\t\t\t@confirm=\"dialogInputConfirm\" @close=\"dialogClose\" :before-close=\"isclosed\">\r\n\t\t\t\t\t\t<template v-slot=\"value\">\r\n\t\t\t\t\t\t\t<view class=\"pay-password\">\r\n\t\t\t\t\t\t\t\t<input type=\"tel\" password=\"password\" maxlength=\"6\" @input=\"getPassword\"\r\n\t\t\t\t\t\t\t\t\t:value=\"password\" class=\"pay-password-input\" />\r\n\t\t\t\t\t\t\t\t<view class=\"pay-error-msg\" v-if=\"isshowError\">\r\n\t\t\t\t\t\t\t\t\t密码格式错误\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</template>\r\n\r\n\t\t\t\t\t</uni-popup-dialog>\r\n\t\t\t\t</uni-popup>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport {\r\n\t\tgetOrderDetail,\r\n\t\tgetLinkContent,\r\n\t\tcheckPay\r\n\t} from '@/api/pay.js'\r\n\timport {\r\n\t\tuseUserStore\r\n\t} from '@/store/user.js'\r\n\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\torderDetail: [],\r\n\t\t\t\tstartTime: '',\r\n\t\t\t\tendTime: '',\r\n\t\t\t\tnow: 0,\r\n\t\t\t\tstudentsNumber: 0,\r\n\t\t\t\tischecked: false,\r\n\t\t\t\tisvisible: false,\r\n\t\t\t\tlinkContent: '',\r\n\t\t\t\tpassword: '',\r\n\t\t\t\ttimer: null,\r\n\t\t\t\tisclosed: true,\r\n\t\t\t\tisshowError: false\r\n\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad(options) {\r\n\t\t\tthis.getContentList(options)\r\n\t\t},\r\n\t\tonUnload() {\r\n\t\t\tclearTimeout(this.timer)\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\t// 计算属性的getter\r\n\t\t\tgetWeeks() {\r\n\t\t\t\tconst start = new Date(this.startTime)\r\n\t\t\t\tconst end = new Date(this.endTime)\r\n\t\t\t\tconst diffTime = Math.abs(end - start)\r\n\t\t\t\tconst diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24))\r\n\t\t\t\tconst weeks = Math.ceil(diffDays / 7)\r\n\t\t\t\treturn weeks\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tasync getContentList(param) {\r\n\t\t\t\tconst res = await getOrderDetail(param)\r\n\t\t\t\tconst {\r\n\t\t\t\t\tdata\r\n\t\t\t\t} = res\r\n\t\t\t\tthis.orderDetail = data\r\n\t\t\t\tconsole.log(data);\r\n\t\t\t\tthis.startTime = data?.time?.startTime\r\n\t\t\t\tthis.endTime = data?.time?.endTime\r\n\t\t\t\tthis.now = data?.time?.weeks.now\r\n\t\t\t\tthis.studentsNumber = data?.students.length\r\n\t\t\t\tconsole.log(this.studentsNumber);\r\n\t\t\t},\r\n\t\t\ttoggleChecked() {\r\n\t\t\t\tthis.ischecked = !this.ischecked\r\n\t\t\t},\r\n\t\t\tasync showLink(type) {\r\n\t\t\t\tconst {\r\n\t\t\t\t\tdata\r\n\t\t\t\t} = await getLinkContent()\r\n\t\t\t\tthis.linkContent = data.content\r\n\t\t\t\tthis.msgType = type\r\n\t\t\t\tthis.$refs.alertDialog.open()\r\n\t\t\t},\r\n\t\t\tdialogConfirm() {\r\n\t\t\t\tthis.ischecked = true\r\n\t\t\t},\r\n\t\t\tdialogClose() {\r\n\t\t\t\tthis.$refs.inputDialog.close()\r\n\t\t\t},\r\n\t\t\tconfirmPay() {\r\n\t\t\t\tif (!this.ischecked) {\r\n\t\t\t\t\tthis.showLink()\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\t// 支付密码弹窗打开\r\n\t\t\t\tthis.$refs.inputDialog.open()\r\n\t\t\t},\r\n\t\t\tasync dialogInputConfirm() {\r\n\t\t\t\t// 密码校验 支付接口（金额、用户、密码）仓库\r\n\t\t\t\tconst {\r\n\t\t\t\t\tdata\r\n\t\t\t\t} = await checkPay(this.orderDetail.amount, this.password, useUserStore().userInfo.userId)\r\n\t\t\t\tif (data?.isTrade) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '支付成功',\r\n\t\t\t\t\t\ticon: \"success\",\r\n\t\t\t\t\t\tmask: true,\r\n\t\t\t\t\t\tduration: 200\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.isclosed = false\r\n\t\t\t\t\tthis.password = ''\r\n\t\t\t\t\tthis.$refs.inputDialog.close()\r\n\t\t\t\t\tthis.timer = setTimeout(() => {\r\n\t\t\t\t\t\tuni.switchTab({\r\n\t\t\t\t\t\t\turl: '/pages/order/index'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}, 500)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '密码错误，请重试',\r\n\t\t\t\t\t\ticon: \"error\",\r\n\t\t\t\t\t\tmask: true,\r\n\t\t\t\t\t\tduration: 500\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.password = ''\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tgetPassword(e) {\r\n\t\t\t\t// 校验输入密码格式\r\n\t\t\t\tthis.isvalidator(e.detail.value);\r\n\t\t\t\tif (e.detail.value.length === 6) {\r\n\t\t\t\t\tthis.password = e.detail.value\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tisvalidator(password) {\r\n\t\t\t\tconst regex = /^\\d{6}$/;\r\n\t\t\t\tif (!regex.test(password)) {\r\n\t\t\t\t\tthis.isshowError = true\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.isshowError = false\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t@import url(./pay.css);\r\n</style>","import MiniProgramPage from 'D:/code/project/Sports-Group-buying/pages/pay/pay.vue'\nwx.createPage(MiniProgramPage)"],"names":["getOrderDetail","uni","getLinkContent","checkPay","useUserStore"],"mappings":"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"}