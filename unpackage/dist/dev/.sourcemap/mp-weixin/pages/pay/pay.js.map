{"version":3,"file":"pay.js","sources":["pages/pay/pay.vue","../../../Program Files/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcGF5L3BheS52dWU"],"sourcesContent":["<template>\r\n\t<view class=\"pay-content\">\r\n\t\t<view class=\"pay-content-top\">\r\n\t\t\t<view class=\"pay-content-detail\">\r\n\t\t\t\t<view class=\"pay-detail-head\">\r\n\t\t\t\t\t<view class=\"pay-head-title\">\r\n\t\t\t\t\t\t{{orderDetail.title}}\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"pay-head-status\">\r\n\t\t\t\t\t\t进行中\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"pay-detail-body\">\r\n\t\t\t\t\t<view class=\"pay-detail-time\">\r\n\t\t\t\t\t\t{{`总周期${getWeeks}期，当前第${now}周`}}\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"pay-detail-rest\">\r\n\t\t\t\t\t\t{{`剩余${orderDetail?.totalNumber - studentsNumber}名额拼满`}}\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"pay-details-msg\">\r\n\t\t\t\t\t<!-- txt -->\r\n\t\t\t\t\t<view class=\"pay-msg-time\">\r\n\t\t\t\t\t\t{{formatFullTime(orderDetail?.creatTime)}}\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"pay-details-msg\">\r\n\t\t\t\t\t<!-- icon -->\r\n\t\t\t\t\t<uni-icons type=\"location\" size=\"24\"></uni-icons>\r\n\t\t\t\t\t<!-- txt -->\r\n\t\t\t\t\t<view class=\"pay-msg-txt\">\r\n\t\t\t\t\t\t{{orderDetail.adress}}\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view class=\"pay-content-bottom\">\r\n\t\t\t<view class=\"pay-bottom-head\">\r\n\t\t\t\t{{orderDetail.title}}\r\n\t\t\t</view>\r\n\t\t\t<view class=\"pay-bottom-tips\">\r\n\t\t\t\t温馨提示：\r\n\t\t\t</view>\r\n\t\t\t<view class=\"pay-bottom-agree\">\r\n\t\t\t\t<label class=\"pay-agree-radio\">\r\n\t\t\t\t\t<radio :checked=\"ischecked\" @click=\"toggleChecked\" />\r\n\t\t\t\t</label>\r\n\r\n\t\t\t\t<view class=\"pay-agree-txt\">\r\n\t\t\t\t\t同意<span class=\"pay-agree-link\" @click=\"showLink('info')\">《跃动星球协议》</span>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view>\r\n\t\t\t\t\t<!-- 提示窗示例 -->\r\n\t\t\t\t\t<uni-popup ref=\"alertDialog\" type=\"dialog\">\r\n\t\t\t\t\t\t<uni-popup-dialog :type=\"msgType\" cancelText=\"关闭\" confirmText=\"同意\" title=\"跃动星球协议\"\r\n\t\t\t\t\t\t\t:content=\"linkContent\" @confirm=\"dialogConfirm\" @close=\"dialogClose\"></uni-popup-dialog>\r\n\t\t\t\t\t</uni-popup>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"pay-bottom-pay\" @click=\"confirmPay\">\r\n\t\t\t\t确认支付\r\n\t\t\t</view>\r\n\t\t\t<view>\r\n\t\t\t\t<!-- 输入框示例 -->\r\n\t\t\t\t<uni-popup ref=\"inputDialog\" type=\"dialog\">\r\n\t\t\t\t\t<uni-popup-dialog ref=\"inputClose\" mode=\"input\" title=\"输入密码\" placeholder=\"请输入密码\"\r\n\t\t\t\t\t\t@confirm=\"dialogInputConfirm\" @close=\"dialogClose\" :before-close=\"isclosed\">\r\n\t\t\t\t\t\t<template v-slot=\"value\">\r\n\t\t\t\t\t\t\t<view class=\"pay-password\">\r\n\t\t\t\t\t\t\t\t<input type=\"tel\" password=\"password\" maxlength=\"6\" @input=\"getPassword\"\r\n\t\t\t\t\t\t\t\t\t:value=\"password\" class=\"pay-password-input\" />\r\n\t\t\t\t\t\t\t\t<view class=\"pay-error-msg\" v-if=\"isshowError\">\r\n\t\t\t\t\t\t\t\t\t密码格式错误\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</template>\r\n\r\n\t\t\t\t\t</uni-popup-dialog>\r\n\t\t\t\t</uni-popup>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport {\r\n\t\tgetOrderDetail,\r\n\t\tgetLinkContent,\r\n\t\tcheckPay\r\n\t} from '@/api/pay.js'\r\n\timport {\r\n\t\tuseUserStore\r\n\t} from '@/store/user.js'\r\n\timport {\r\n\t\tuseAuth\r\n\t} from '../../utils/getUserInfo'\r\n\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\torderDetail: [],\r\n\t\t\t\tstartTime: '',\r\n\t\t\t\tendTime: '',\r\n\t\t\t\tnow: 0,\r\n\t\t\t\tstudentsNumber: 0,\r\n\t\t\t\tischecked: false,\r\n\t\t\t\tisvisible: false,\r\n\t\t\t\tlinkContent: '',\r\n\t\t\t\tpassword: '',\r\n\t\t\t\ttimer: null,\r\n\t\t\t\tisclosed: true,\r\n\t\t\t\tisshowError: false,\r\n\t\t\t\tuser_id: useUserStore().userInfo.user_id,\r\n\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad(options) {\r\n\t\t\tconsole.log(Object.keys(options)[0])\r\n\t\t\tif (Object.keys(options)[0] === 'courseId') {\r\n\t\t\t\tthis.getCreateOrder(options.courseId)\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t}\r\n\r\n\t\t\tconst {\r\n\t\t\t\tisLogin\r\n\t\t\t} = useAuth()\r\n\t\t\tif (!isLogin()) {\r\n\t\t\t\tconsole.log('未登录，已跳转')\r\n\t\t\t} else {\r\n\t\t\t\tconsole.log('已登录，继续执行业务逻辑')\r\n\t\t\t}\r\n\t\t},\r\n\t\tonUnload() {\r\n\t\t\tclearTimeout(this.timer)\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\t// 计算属性的getter\r\n\t\t\tgetWeeks() {\r\n\t\t\t\tconst start = new Date(this.startTime)\r\n\t\t\t\tconst end = new Date(this.endTime)\r\n\t\t\t\tconst diffTime = Math.abs(end - start)\r\n\t\t\t\tconst diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24))\r\n\t\t\t\tconst weeks = Math.ceil(diffDays / 7)\r\n\t\t\t\treturn weeks\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tformatFullTime(ts) {\r\n\t\t\t\tconst date = new Date(Number(ts));\r\n\t\t\t\tconst y = date.getFullYear();\r\n\t\t\t\tconst m = (date.getMonth() + 1).toString().padStart(2, '0');\r\n\t\t\t\tconst d = date.getDate().toString().padStart(2, '0');\r\n\t\t\t\tconst h = date.getHours().toString().padStart(2, '0');\r\n\t\t\t\tconst min = date.getMinutes().toString().padStart(2, '0');\r\n\t\t\t\treturn `${y}/${m}/${d} ${h}:${min}`;\r\n\t\t\t},\r\n\t\t\tgetNow(startTime, endTime) {\r\n\t\t\t\tconst now = Date.now();\r\n\r\n\t\t\t\tstartTime = Number(startTime);\r\n\t\t\t\tendTime = Number(endTime);\r\n\r\n\t\t\t\tif (now < startTime) {\r\n\t\t\t\t\treturn 0; // 课程未开始\r\n\t\t\t\t}\r\n\t\t\t\tif (now > endTime) {\r\n\t\t\t\t\treturn Math.ceil((endTime - startTime) / (7 * 24 * 60 * 60 * 1000)); // 课程已结束，返回总周数\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst diff = now - startTime;\r\n\t\t\t\tconst weekMs = 7 * 24 * 60 * 60 * 1000; // 一周的毫秒数\r\n\r\n\t\t\t\tconst week = Math.ceil(diff / weekMs);\r\n\t\t\t\treturn week;\r\n\t\t\t},\r\n\t\t\tasync getCreateOrder(courseId) {\r\n\t\t\t\tconsole.log(courseId)\r\n\t\t\t\tconst data = await getOrderDetail({\r\n\t\t\t\t\tcourseId: courseId,\r\n\t\t\t\t\tuserId: this.user_id\r\n\t\t\t\t})\r\n\t\t\t\tthis.orderDetail = data\r\n\t\t\t\tconsole.log(data);\r\n\t\t\t\tconsole.log(data?.time?.startTime)\r\n\t\t\t\tthis.startTime = this.formatFullTime(data?.time?.startTime);\r\n\t\t\t\tthis.endTime = this.formatFullTime(data?.time?.endTime);\r\n\t\t\t\tthis.now = this.getNow(data?.time?.startTime, data?.time?.endTime)\r\n\t\t\t\tthis.studentsNumber = data?.students.length\r\n\t\t\t\tconsole.log(this.studentsNumber);\r\n\t\t\t},\r\n\t\t\ttoggleChecked() {\r\n\t\t\t\tthis.ischecked = !this.ischecked\r\n\t\t\t},\r\n\t\t\tasync showLink(type) {\r\n\t\t\t\tconst data = await getLinkContent()\r\n\t\t\t\tthis.linkContent = data.content\r\n\t\t\t\tthis.msgType = type\r\n\t\t\t\tthis.$refs.alertDialog.open()\r\n\t\t\t},\r\n\t\t\tdialogConfirm() {\r\n\t\t\t\tthis.ischecked = true\r\n\t\t\t},\r\n\t\t\tdialogClose() {\r\n\t\t\t\tthis.$refs.inputDialog.close()\r\n\t\t\t},\r\n\t\t\tconfirmPay() {\r\n\t\t\t\tif (!this.ischecked) {\r\n\t\t\t\t\tthis.showLink()\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\t// 支付密码弹窗打开\r\n\t\t\t\tthis.$refs.inputDialog.open()\r\n\t\t\t},\r\n\t\t\tasync dialogInputConfirm() {\r\n\t\t\t\t// 密码校验 支付接口（金额、用户、密码）仓库\r\n\t\t\t\tconst data = await checkPay({\r\n\t\t\t\t\torderId: this.orderDetail?.orderId,\r\n\t\t\t\t\tpayPassword: this.password,\r\n\t\t\t\t})\r\n\t\t\t\tif (data?.isTrade) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '支付成功',\r\n\t\t\t\t\t\ticon: \"success\",\r\n\t\t\t\t\t\tmask: true,\r\n\t\t\t\t\t\tduration: 200\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.isclosed = false\r\n\t\t\t\t\tthis.password = ''\r\n\t\t\t\t\tthis.$refs.inputDialog.close()\r\n\t\t\t\t\tthis.timer = setTimeout(() => {\r\n\t\t\t\t\t\tuni.switchTab({\r\n\t\t\t\t\t\t\turl: '/pages/order/index'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}, 500)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '密码错误，请重试',\r\n\t\t\t\t\t\ticon: \"error\",\r\n\t\t\t\t\t\tmask: true,\r\n\t\t\t\t\t\tduration: 500\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.password = ''\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tgetPassword(e) {\r\n\t\t\t\t// 校验输入密码格式\r\n\t\t\t\tthis.isvalidator(e.detail.value);\r\n\t\t\t\tif (e.detail.value.length === 6) {\r\n\t\t\t\t\tthis.password = e.detail.value\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tisvalidator(password) {\r\n\t\t\t\tconst regex = /^\\d{6}$/;\r\n\t\t\t\tif (!regex.test(password)) {\r\n\t\t\t\t\tthis.isshowError = true\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.isshowError = false\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t@import url(./pay.css);\r\n</style>","import MiniProgramPage from 'D:/code/project/Sports-Group-buying/pages/pay/pay.vue'\nwx.createPage(MiniProgramPage)"],"names":["useUserStore","uni","useAuth","getOrderDetail","getLinkContent","checkPay"],"mappings":"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"}