{"version":3,"file":"getUserInfo.js","sources":["pages/getUserInfo/getUserInfo.vue","../../../Program Files/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZ2V0VXNlckluZm8vZ2V0VXNlckluZm8udnVl"],"sourcesContent":["<template>\r\n\t<view class=\"login-content\">\r\n\t\t<image src=\"/static/icon/ball.png\" class=\"login-background-image\"></image>\r\n\t\t<view class=\"login-phoneNumber-input\" v-if=\"!isAdmin\">\r\n\t\t\t<uni-easyinput type=\"number\" value=\"phone\" @input=\"getPhoneNumber\" @clear=\"clear\" style=\"font-size: 16rpx;\"\r\n\t\t\t\tmaxlength=\"11\" class=\"login-phoneNumber-input\">\r\n\t\t\t\t<template #left>\r\n\t\t\t\t\t<view>+86</view>\r\n\t\t\t\t</template>\r\n\t\t\t</uni-easyinput>\r\n\t\t</view>\r\n\t\t<view v-if=\"isAdmin\" class=\"login-phoneNumber-input\">\r\n\t\t\t<uni-easyinput type=\"text\" v-model=\"admin\" @input=\"adminInput\" @clear=\"clear\" style=\"font-size: 16rpx;\"\r\n\t\t\t\tmaxlength=\"11\" class=\"login-phoneNumber-input\">\r\n\t\t\t\t<template #left>\r\n\t\t\t\t\t<view>管理员账号</view>\r\n\t\t\t\t</template>\r\n\t\t\t</uni-easyinput>\r\n\t\t</view>\r\n\t\t<view class=\"login-code-input\" v-if=\"!isAdmin\">\r\n\t\t\t<uni-easyinput type=\"number\" value=\"loginCode\" @input=\"codeInput\" maxlength=\"6\" class=\"login-code-input\">\r\n\t\t\t\t<template #left>\r\n\t\t\t\t\t<view>验证码</view>\r\n\t\t\t\t</template>\r\n\t\t\t\t<template #right>\r\n\t\t\t\t\t<view class=\"login-code-second\" @click=\"getCode\">\r\n\t\t\t\t\t\t{{isgetCode?`${second}s`:getCodeTxt}}\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</template>\r\n\t\t\t</uni-easyinput>\r\n\t\t</view>\r\n\t\t<view class=\"login-code-input\" v-if=\"isAdmin\">\r\n\t\t\t<uni-easyinput type=\"number\" value=\"adminPassword\" @input=\"adminPasswordInput\" maxlength=\"20\"\r\n\t\t\t\tclass=\"login-code-input\">\r\n\t\t\t\t<template #left>\r\n\t\t\t\t\t<view>密码</view>\r\n\t\t\t\t</template>\r\n\r\n\t\t\t</uni-easyinput>\r\n\t\t</view>\r\n\t\t<view class=\"login-btn\" @click=\"login\">\r\n\t\t\t登录\r\n\t\t</view>\r\n\t\t<view>\r\n\t\t\t没有账号会自动注册\r\n\t\t</view>\r\n\t\t<view class=\"admin-btn\" @click=\"toggleAdmin\">\r\n\t\t\t{{isAdmin?'用户登录':'管理员登录'}}\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport {\r\n\t\tgetLoginCode,\r\n\t\tgetLogin\r\n\t} from '../../api/login'\r\n\timport {\r\n\t\tuseUserStore\r\n\t} from '../../store/user'\r\n\timport {\r\n\t\tadminLogin\r\n\t} from '../../api/admin'\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\ttotalSecond: 5,\r\n\t\t\t\tsecond: 5,\r\n\t\t\t\tisgetCode: false,\r\n\t\t\t\tgetCodeTxt: '获取验证码',\r\n\t\t\t\tphone: '',\r\n\t\t\t\tadmin: '',\r\n\t\t\t\tadminPassword: '',\r\n\t\t\t\tloginCode: '',\r\n\t\t\t\turl: '',\r\n\t\t\t\ttimer: null,\r\n\t\t\t\tcode: '',\r\n\t\t\t\tisAdmin: false\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad(options) {\r\n\t\t\tconsole.log(options)\r\n\t\t},\r\n\t\tonUnload() {\r\n\t\t\tclearTimeout(this.timer)\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tgetPhoneNumber(e) {\r\n\t\t\t\tthis.phone = e\r\n\t\t\t},\r\n\t\t\tadminInput(e) {\r\n\t\t\t\tthis.admin = e\r\n\t\t\t\tconsole.log(this.admin)\r\n\t\t\t},\r\n\t\t\tadminPasswordInput(e) {\r\n\t\t\t\tthis.adminPassword = e\r\n\t\t\t\tconsole.log(this.adminPassword)\r\n\t\t\t},\r\n\r\n\t\t\tcodeInput(e) {\r\n\t\t\t\tconsole.log(e)\r\n\t\t\t\tthis.loginCode = e\r\n\t\t\t\tconsole.log(this.loginCode)\r\n\t\t\t},\r\n\t\t\tclear() {\r\n\t\t\t\tthis.phone = ''\r\n\t\t\t},\r\n\t\t\tvalidatePhoneNum(phoneNum) {\r\n\t\t\t\tconst phoneReg = /^1[3-9]\\d{9}$/\r\n\t\t\t\tif (phoneReg.test(phoneNum)) {\r\n\t\t\t\t\treturn true\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: \"请输入正确的手机号\",\r\n\t\t\t\t\t\ticon: \"none\"\r\n\t\t\t\t\t})\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tvalidateCode(code) {\r\n\t\t\t\tconst codeReg = /^\\d{6}$/\r\n\t\t\t\tif (codeReg.test(code)) {\r\n\t\t\t\t\treturn true\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: \"请输入正确的验证码\",\r\n\t\t\t\t\t\ticon: \"none\"\r\n\t\t\t\t\t})\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 倒计时\r\n\t\t\tasync getCode() {\r\n\t\t\t\tif (!this.validatePhoneNum(this.phone)) {\r\n\t\t\t\t\t// 没通过校验return\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\t// 调用获取验证码的接口\r\n\t\t\t\tconst res = await getLoginCode(this.phone)\r\n\t\t\t\tconsole.log(res)\r\n\t\t\t\tthis.code = res?.code\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: `验证码：${res?.code}`\r\n\t\t\t\t})\r\n\t\t\t\t// 开启倒计时\r\n\t\t\t\tthis.isgetCode = true\r\n\t\t\t\tif (!this.timer && this.second === this.totalSecond) {\r\n\t\t\t\t\tconsole.log(this.isgetCode)\r\n\t\t\t\t\tthis.timer = setInterval(() => {\r\n\t\t\t\t\t\tthis.second--\r\n\t\t\t\t\t\tif (this.second <= 0) {\r\n\t\t\t\t\t\t\tthis.isgetCode = false\r\n\t\t\t\t\t\t\tclearInterval(this.timer)\r\n\t\t\t\t\t\t\tthis.timer = null\r\n\t\t\t\t\t\t\tthis.second = this.totalSecond\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, 1000)\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tasync login() {\r\n\t\t\t\tif (this.isAdmin) {\r\n\t\t\t\t\tconst res = await adminLogin({\r\n\t\t\t\t\t\taccount: this.admin,\r\n\t\t\t\t\t\tpassword: this.adminPassword\r\n\t\t\t\t\t})\r\n\t\t\t\t\tconsole.log(res)\r\n\r\n\t\t\t\t\tuseUserStore().setUserInfo(res)\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: \"登陆成功\",\r\n\t\t\t\t\t\ticon: \"success\",\r\n\t\t\t\t\t\tmask: true,\r\n\t\t\t\t\t\tduration: 500\r\n\t\t\t\t\t})\r\n\t\t\t\t\tuni.setStorage({\r\n\t\t\t\t\t\tkey: 'userInfo',\r\n\t\t\t\t\t\tdata: JSON.stringify(res)\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.timer = setTimeout(() => {\r\n\t\t\t\t\t\tuni.reLaunch({\r\n\t\t\t\t\t\t\turl: \"/pages/adminIndex/adminIndex\"\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}, 500)\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\t// 格式校验\r\n\t\t\t\tif (!this.validatePhoneNum(this.phone) && !this.validateCode(this.loginCode)) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\t// 登录接口\r\n\t\t\t\tconsole.log('验证码')\r\n\t\t\t\tconsole.log(this.loginCode)\r\n\t\t\t\tconst res = await getLogin({\r\n\t\t\t\t\tphone: this.phone,\r\n\t\t\t\t\tcode: this.loginCode\r\n\t\t\t\t})\r\n\t\t\t\tconsole.log('登录信息')\r\n\t\t\t\tconsole.log(res)\r\n\t\t\t\tuseUserStore().setUserInfo(res)\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: \"登陆成功\",\r\n\t\t\t\t\ticon: \"success\",\r\n\t\t\t\t\tmask: true,\r\n\t\t\t\t\tduration: 500\r\n\t\t\t\t})\r\n\t\t\t\tuni.setStorage({\r\n\t\t\t\t\tkey: 'userInfo',\r\n\t\t\t\t\tdata: JSON.stringify(res)\r\n\t\t\t\t})\r\n\t\t\t\tthis.timer = setTimeout(() => {\r\n\t\t\t\t\tuni.reLaunch({\r\n\t\t\t\t\t\turl: \"/pages/user/index\"\r\n\t\t\t\t\t})\r\n\t\t\t\t}, 500)\r\n\r\n\t\t\t},\r\n\t\t\ttoggleAdmin() {\r\n\t\t\t\tthis.isAdmin = !this.isAdmin\r\n\t\t\t\tthis.admin = '',\r\n\t\t\t\t\tthis.adminPassword = '',\r\n\t\t\t\t\tthis.phone = '',\r\n\t\t\t\t\tthis.loginCode = ''\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n\t@import url(./getUserInfo.css);\r\n</style>","import MiniProgramPage from 'D:/code/project/Sports-Group-buying/pages/getUserInfo/getUserInfo.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","getLoginCode","res","adminLogin","useUserStore","getLogin"],"mappings":"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"}